{% extends 'master.html.twig' %}

{% block title %}
    {% include "utilities/page-title.html.twig" with { 'pageTitle': pageTitle } %}
{% endblock %}

{% block logo_img %}
    {% include 'partials/shared/logo-box-@header.html.twig' %}
{% endblock %}

{% block top_header_right %}
    {% include 'partials/shared/logout-box-@header.html.twig' %}
{% endblock %}

{% block top_css_block %}
    <script type="text/javascript" src="{{ asset('js/lib/highcharts/highcharts.js') }}"></script>
    <link rel="stylesheet" href="{{ asset('css/melanie.css') }}">
    <link rel="stylesheet" href="{{ asset('css/melanie-calendar-2.css') }}">
    <script src="{{ asset('tinymce/js/tinymce/tinymce.min.js') }}" type="text/javascript"></script>
    <script src="{{ asset('js/TinyMceInit.js') }}"></script>
    
    <style>
        .pz-sub-page-heading,
        #pz-sub-page-heading {
            display:block;
            padding: 8px 15px;
            background: black;
            color: white;
            text-align: left;
            margin-bottom: 0;
            font-size: 1.25em;
        }
        
        .pz-info-box-wrapper{
            background: #f1f1f1;
            padding: 15px;
            border: solid 1px #e0e0e0;
            margin-bottom: -10px;
        }
        
        .pz-info-box-wrapper .pz-info-box{
        
        }
        .pz-info-box-wrapper .pz-info-box h3 {
            margin: 10px 0;
            padding: 8px 0px;
            display: inline-block;
            border-top: dashed 1px #d2d2d2;
            border-bottom: dashed 1px #d2d2d2;
            color: #525252;
            font-weight: 700;
            font-size: 1.4em;
        }
        
        .pz-filter-extra {
            grid-column: 1 / 4;
            margin: 5px 0;
            margin-bottom: -15px;
            background: black;
            padding: 10px 15px;
            font-size: 1.5em;
            font-weight: 500;
            color: white;
        }
        .table tr:nth-child(2n+1) {
            background: #f1f1f1;
            background-color: #f1f1f1;
        }
        .table tr.pz-tbl-footer,
        .table tr.pz-tbl-footer:nth-child(2n+1),
        .pz-wrapper .table-responsive .table tr.pz-tbl-footer,
        .pz-wrapper .table-responsive .table tr.pz-tbl-footer:nth-child(2n){
            box-shadow: -1px 0 1px 1px rgba(0, 0, 0, 0.75);
        }
        
        .table  tr.pz-tbl-footer td,
        .table  tr.pz-tbl-footer th,
        .table tr.pz-tbl-footer td,
        .table tr.pz-tbl-footer:nth-child(2n+1) td,
        .pz-wrapper .table-responsive .table tr.pz-tbl-footer td,
        .pz-wrapper .table-responsive .table tr.pz-tbl-footer:nth-child(2n+1) td,
        .pz-wrapper .table-responsive .table tr.pz-tbl-footer:nth-child(2n) td {
            background: #b3b3b3;
            color: black;
            font-weight: 900;
        }
        
        .pz-wrapper .table-responsive .table.table-bordered>tfoot>tr>th,
        .pz-wrapper .table-responsive .table.table-bordered>tfoot>tr>td{
        }
        .table tfoot {  }
        aside.pz-aside-info {
            text-align: left;
            padding: 5px 15px;
            border-bottom: solid 1px #6d6d6d;
            background: #cecece;
            font-size: 1.3em;
        }
        .pz-cash-payments-toggle,
        .pz-card-payments-toggle,
        .pz-debitors-toggle,
        .pz-cash-expenses-toggle,
        .pz-summary-toggle{
            cursor: pointer;
            color: #878e27;
            text-shadow: 1px 1px 1px black;
        }
        aside.pz-aside-info .pz-sales-stats-toggle{
            cursor: pointer;
            color: #005f00;
        }
        .pz-cash-payments-toggle.pz-state-off,
        .pz-card-payments-toggle.pz-state-off,
        .pz-debitors-toggle.pz-state-off,
        .pz-cash-expenses-toggle.pz-state-off,
        .pz-summary-toggle.pz-state-off,
        aside.pz-aside-info .pz-sales-stats-toggle.pz-state-off{
            color: #b50050; /*#710032;*/
        }
        .pz-cash-payments-toggle.pz-state-on,
        .pz-card-payments-toggle.pz-state-on,
        .pz-debitors-toggle.pz-state-on,
        .pz-cash-expenses-toggle.pz-state-on,
        .pz-summary-toggle.pz-state-on{
            color: #878e27; /* #66c166; */
        }
        aside.pz-aside-info .pz-sales-stats-toggle.pz-state-on{
            color: #005f00;
        }
        text.highcharts-credits {
            display: none;
        }
        .pz-well{
            border-color: #cecece;
            background: rgb(245, 245, 245);
            margin-bottom: 0;
            border-radius: 0;
        }
        .pz-wrapper .table-responsive .table-striped a {
            color: black;
            text-shadow: none;
            text-align: left;
        }
    
    </style>
{% endblock %}


{% set verkaufid            = null %}
{% set cashSales            = (cashSales is defined) ? cashSales : { 'mjrSalesTotal' : '0', 'mjrSalesCount' : '0' } %}
{% set totalDebit           = 0 %}
{% set grandTotal           = 0 %}
{% set countTotal           = 0 %}
{% set groupedCount         = 0 %}
{% set totalCashExpenses    = 0 %}
{% set cardsPaymentTotal    = 0 %}

{% block full_width_content %}
    <section id="pz-main-wrapper" class="pz-main-wrapper no-lr-pad containR">
        {% include'partials/shared/scroll-to-top.html.twig' %}
        <section>
            <section >
                <div class="pz-time-tracker-wrapper col-md-12 no-lr-pad">
                    <div class="col-md-12 no-lr-pad pz-form-wrapper" id="pz-form-wrapper">
                        <section class="pz-form-centered">
                            <div style="clear: both;"></div>
                            
                            <div class="col-md-12 no-lr-pad pz-wrapper-main" id="pz-wrapper-main">
                                {% include '/admin/partials/navigation.html.twig' with {'navPayload': navPayload}  %}
                                <header class="pz-page-title-header">
                                    <h1 class="pz-page-title">{{ pageTitle | html }}</h1>
                                </header>
                                
                                {% include'partials/flash-message.render.html.twig' %}
                                
                                <div class="pz-wrapper">
                                    {% if formWidgets is defined and formWidgets %}
                                        <div class="no-print">
                                            {% if formWidgets is defined and formWidgets %}
                                                <h5 id="pz-sub-page-heading" class="pz-sub-page-heading">Bitte gewünschte Daten eingeben</h5>
                                                {% include 'partials/shared/form/dynamic-form.html.twig' with {
                                                    "btnText": btnText,
                                                    "formWidgets": formWidgets
                                                } %}
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                    
                                    {#  70% BY 30% GRID SETUP: START #}
                                    <div class="pz-grid-4-cols pz-stats-data-wrapper" id="pz-stats-data-wrapper">
                                        {#  70% GRID SETUP: START #}
                                        <div class="pz-col-1--1-3-grid">
                                            <h5 class="pz-sub-page-heading">
                                                {% if department is defined and department  %}
                                                    Filiale {{ app.user.friendlyName }}
                                                {% endif %}
                                            </h5>
                                            {% if resultSet is defined and resultSet %}
                                                <aside class="pz-aside-info"><strong>Ladenverkäufe</strong><span data-tip="Datentabelle<br />Ein/Ausschalten" class="fa fa-eye-slash pull-right pz-sales-stats-toggle"></span></aside>
                                                {% set total = 0 %}
                                                <section class="pz-all-sales-wrapper">
                                                    {% for salesGroup in resultSet %}
                                                        {% if salesGroup  %}
                                                            {% set groupedCount = groupedCount + 1 %}
                                                            {% set total        = 0 %}
                                                            {% set once         = true %}
                                                            <div class="table-responsive">
                                                            <table class="table table-striped table-bordered table-striped">
                                                        {% endif %}
                                                        {% for data in salesGroup %}
                                                            {% set verkaufid        = data.verkaufid %}
                                                            {% set countTotal       = data.totalCount %}
                                                            {% set total            = total + data.BH_Journal_betrag %}
                                                            {% set grandTotal       = grandTotal + data.BH_Journal_betrag %}
                                                            {% set paymentMethod    = data.Zahlungsmittel_kurz %}
                                                            
                                                            <tr>
                                                                <td class="name" style="width:25%;">
                                                                    {% if once %}
                                                                        {% include 'partials/statistics/company-name-date-time-injector.html.twig' with {'data': data} %}
                                                                        {% set once = false %}
                                                                    {% endif %}
                                                                </td>
                                                                <td class="produkt" style="width:15%;">{{ data.kat_name }}</td>
                                                                <td class="beschrieb" style="width:23%;">{{ data.BH_Journal_kommentar | html }}</td>
                                                                <td class="karte" style="width:5%;">{{ data.Zahlungsmittel_kurz }}</td>
                                                                <td class="betrag" style="width:7%;">{{ data.BH_Journal_betrag | abs }}</td>
                                                                <td class="no-print"  style="width:20%;">
                                                                    <!-- "tagesabrechnung.php?loeschen=1&postenid='.$row_statistik['BH_Journal_id'].'&id_verkauf='.$verkaufsnummer.'" -->
                                                                    <a href="{{ path('rte_admin_delete_sale_entry', {'bhj_id': data.BH_Journal_id}) }}"
                                                                       data-tip="Teilkauf - <strong>Nr. {{ data.BH_Journal_id }}</strong><br /><strong style='color:darkred;'>entfernen</strong>"
                                                                       data-warn-b4-delete="1"
                                                                       data-delete-question="Möchtest Du wirklich dieser Teilkauf mit ID: {{ data.BH_Journal_id }} aus diesem Verkäuf {{ data.verkaufid }} <strong style='color:red'>löschen?</strong>"><span class="fa fa-trash"></span></a>
                                                                </td>
                                                            </tr>
                                                        {% endfor%}
                                                        
                                                        <tr class="pz-tbl-footer">
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td>&nbsp;</td>
                                                            <td><strong class="pz-cash-color">{{ total }}</strong></td>
                                                            <td class="icon no-print">
                                                                {% include "partials/statistics/stats-crud-icons.html.twig" with {
                                                                    'verkaufid'    : verkaufid,
                                                                } %}
                                                            </td>
                                                        </tr>
                                                        
                                                        {% if salesGroup is defined and salesGroup %}
                                                            </table>
                                                            </div>
                                                        {% endif %}
                                                    {% endfor%}
                                                </section>
                                                
                                                <!-- TABLE FOR TOTALS: BEGIN -->
                                                <div class="table-responsive">
                                                    <table class="table table-striped table-bordered">
                                                        <tr>
                                                            <td><strong>Total</strong></td>
                                                            <td><strong>CHF {{ grandTotal }}</strong></td>
                                                        </tr>
                                                        <tr>
                                                            <td><strong>Anzahl Verkäufe</strong></td>
                                                            <td>{{ groupedCount }}</td>
                                                        </tr>
                                                        <tr>
                                                            <td><strong>Durchschnittsbetrag</strong></td>
                                                            <td>CHF {{ (grandTotal/groupedCount) | decimal(2) }}</td>
                                                        </tr>
                                                    </table>
                                                </div>
                                                <!-- TABLE FOR TOTALS: END -->
                                                
                                                <!-- TABLE FOR CATEGORIZED DATA: BEGIN -->
                                                {% if categorizedData is defined and categorizedData %}
                                                    <section class="pz-grid-2-cols">
                                                        {# CATEGORIZED DATA TABLE-BLOCK: BEGIN #}
                                                        <aside class="pz-col-1">
                                                            <div class="table-responsive">
                                                                <table class="table table-striped table-bordered">
                                                                    {% for catData in categorizedData %}
                                                                        <tr>
                                                                            <td><strong> {{ catData.category }}</strong></td>
                                                                            <td>{{ catData.total  }}</td>
                                                                            <td>{{ percentFromArraySum(categorizedData, catData.total) }}</td>
                                                                        </tr>
                                                                    {% endfor %}
                                                                </table>
                                                            </div>
                                                        </aside>
                                                        {# CATEGORIZED DATA TABLE-BLOCK: END #}
                                                        {# POSSIBLE BAR OR PIE CHART: BEGIN #}
                                                        <aside class="pz-col-2">
                                                            <div id="chartBlock" class="chartBlock"></div>
                                                            <script>
                                                                // const chartsPayloadJSON = `{ chartsData | raw }`;
                                                                const chartsPayloadJSON = `{{ getChartsData(categorizedData) | raw }}`;
                                                                const chartsPayload     = JSON.parse(chartsPayloadJSON);
                                                                console.log(chartsPayload);
                                                                
                                                                Highcharts.chart('chartBlock', {
                                                                    chart: {
                                                                        plotBackgroundColor: null,
                                                                        plotBorderWidth: null,
                                                                        plotShadow: false,
                                                                        type: 'pie'
                                                                    },
                                                                    title: {
                                                                        text: 'Verkaufstatistik - Kuchendiagramm'
                                                                    },
                                                                    tooltip: {
                                                                        pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                                                                    },
                                                                    plotOptions: {
                                                                        pie: {
                                                                            allowPointSelect: true,
                                                                            cursor: 'pointer',
                                                                            dataLabels: {
                                                                                enabled: true,
                                                                                format: '<b>{point.name}</b>: {point.percentage:.1f} %'
                                                                            }
                                                                        }
                                                                    },
                                                                    
                                                                    series: [{
                                                                        name: 'Kategorie',
                                                                        colorByPoint: true,
                                                                        data: chartsPayload.data
                                                                    }]
                                                                    
                                                                });
                                                            </script>
                                                        </aside>
                                                        {# POSSIBLE BAR OR PIE CHART: END #}
                                                    </section>
                                                {% endif %}
                                                <!-- TABLE FOR CATEGORIZED DATA: END -->
                                            {% else %}
                                                <aside class="pz-aside-info"><strong>keine Verkäufe</strong></aside>
                                            {% endif %}
                                            
                                            {# CASH PAYMENTS: BEGIN#}
                                            {% if cashPayments is defined and cashPayments is not empty and cashPayments is not null %}
                                                {% set personID = app.user.personId %}
                                                {% if cashPayments[personID] is defined and cashPayments[personID]['salesCount'] > 0 %}
                                                    <div class="table-responsive">
                                                        <h5 class="pz-sub-page-heading">Barzahlungen <span data-tip="Datentabelle<br />Ein/Ausschalten" class="fa fa-eye-slash pull-right pz-cash-payments-toggle"></span></h5>
                                                        <table class="table table-bordered table-striped pz-cash-payments-tbl">
                                                            <tr class="pz-payment">
                                                                <td class="pz-pay-box" style="width:75%;"><strong>bar {{ app.user.friendlyName }}</strong></td>
                                                                <td class="pz-pay-box"><strong class="pz-cash-color">CHF {{ cashPayments[personID]['salesTotal'] }}</strong></td>
                                                            </tr>
                                                        </table>
                                                    </div>
                                                {% endif %}
                                            {% endif %}
                                            {# CASH PAYMENTS: END#}
                                            
                                            
                                            {# CARDS PAYMENTS: BEGIN#}
                                            {% if cardsPayments is defined and cardsPayments is not empty and cardsPayments is not null %}
                                                {% for cardPayment in cardsPayments %}
                                                    {% if cardPayment.salesCount %}
                                                        {% set cardsPaymentTotal = cardsPaymentTotal + cardPayment.salesTotal  %}
                                                    {% endif %}
                                                {% endfor %}
                                                
                                                {% if cardsPaymentTotal > 0 %}
                                                    <div class="table-responsive">
                                                        <h5 class="pz-sub-page-heading">Kartenzahlungen <span data-tip="Datentabelle<br />Ein/Ausschalten" class="fa fa-eye-slash pull-right pz-card-payments-toggle"></span></h5>
                                                        <table class="table table-bordered table-striped  pz-card-payments-tbl">
                                                            {% for cardPayment in cardsPayments %}
                                                                <tr class="pz-payment">
                                                                    <td class="pz-pay-box" style="width:75%;"><strong>{{ cardPayment.cardName }}</strong></td>
                                                                    <td class="pz-pay-box">
                                                                        {% if cardPayment.salesCount %}
                                                                            {# % set cardsPaymentTotal = cardsPaymentTotal + cardPayment.salesTotal  % #}
                                                                            <strong class="pz-cash-color">CHF {{ cardPayment.salesTotal }} &nbsp;[ {{ cardPayment.salesCount }} ]</strong>
                                                                        {% else %}
                                                                            <strong class="pz-cash-color">CHF 0</strong>
                                                                        {% endif %}
                                                                    </td>
                                                                </tr>
                                                            {% endfor %}
                                                            
                                                            <!-- TOTALS INJECTION: BEGIN -->
                                                            <tr style="background:darkgray;">
                                                                <td colspan="1"><strong>Total</strong></td>
                                                                <td colspan="1"><strong>CHF {{ cardsPaymentTotal }}</strong></td>
                                                            </tr>
                                                            <!-- TOTALS INJECTION: END -->
                                                        </table>
                                                    </div>
                                                {% endif %}
                                            {% endif %}
                                            {# CARDS PAYMENTS: END#}
                                            
                                            
                                            {# PAY-PAL PAYMENTS: BEGIN#}
                                            {% if payPalPayments is defined and payPalPayments is not empty and payPalPayments.salesCount > 0 %}
                                                <div class="table-responsive">
                                                    <h5 class="pz-sub-page-heading">Paypal-Zahlungen</h5>
                                                    <table class="table table-bordered table-striped">
                                                        <tr class="pz-payment">
                                                            <td class="pz-pay-box" style="width:75%;"><strong>Paypal</strong></td>
                                                            <td class="pz-pay-box"><strong class="pz-cash-color">CHF {{payPalPayments.salesTotal}} [ {{payPalPayments.salesCount}} ]</strong></td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            {% endif %}
                                            {# PAY-PAL PAYMENTS: END#}
                                            
                                            
                                            {# DEBITORS: BEGIN#}
                                            <div class="table-responsive">
                                                <h5 class="pz-sub-page-heading">Debitoren<span data-tip="Datentabelle<br />Ein/Ausschalten" class="fa fa-eye-slash pull-right pz-debitors-toggle"></span></h5>
                                                {% if debitORS is defined and debitORS is not empty and debitORS is not null %}
                                                    {% set deb_kunde_alt    = "" %}
                                                    {% set deb_start        = 0 %}
                                                    <table class="table table-bordered table-striped pz-debitors-tbl">
                                                        {% for debitOR in debitORS %}
                                                            {% set totalDebit = totalDebit + debitOR.BH_Journal_betrag  %}
                                                            <tr class="pz-payment">
                                                                <td class="name_debitoren">
                                                                    <a href="{{ path('rte_admin_individual_account_statement', {'cid': debitOR.kundenid, 'all': 1}) }}">{{ getTicketTargetClient(debitOR) | html }}</a>
                                                                </td>
                                                                <td class="produkt">{{ debitOR.kat_name | html }}</td>
                                                                <td class="beschrieb_debitoren">{{ debitOR.BH_Journal_kommentar | html }}</td>
                                                                <td class="betrag" style="width:10%;">{{ debitOR.BH_Journal_betrag | abs }}</td>
                                                                <td class="icon no-print" style="width:15%;">
                                                                    {# @Route("/admin/buchhaltung/rechnung-bearbeiten/haupt/{id}/{bhj_id}/{date}", name="rte_admin_edit_bill") #}
                                                                    <a href="{{ path('rte_admin_edit_bill_main', {'id': debitOR.Rechnung_id, 'bhj_id': debitOR.BH_Journal_id}) }}"
                                                                       data-id=""
                                                                       data-tip="Rechnung mit <strong>ID - {{ debitOR.Rechnung_id }}</strong><br /><strong style='color:darkgreen;'>bearbeiten.</strong>"
                                                                    ><span class="fa fa-pencil"></span>
                                                                    </a>
                                                                    {#  Beim Löschen wird ebenfalls der Button entsprechend verlinkt #}
                                                                    <a href="{{ path('rte_admin_delete_sale_entry', {'bhj_id': debitOR.BH_Journal_id}) }}"
                                                                       data-id=""
                                                                       data-tip="Rechnung mit <strong>ID - {{ debitOR.Rechnung_id }}</strong><br /><strong style='color:darkred;'>entfernen.</strong>"
                                                                       data-warn-b4-delete="1"
                                                                       data-delete-question="Möchtest Du wirklich dieser Eintrag - Nr. {{ debitOR.BH_Journal_id }}  aus den BH Journal <strong style='color:red'>löschen?</strong>"
                                                                    ><span class="fa fa-trash"></span>
                                                                    </a>
                                                                </td>
                                                            </tr>
                                                        {% endfor %}
                                                        
                                                        <!-- TOTALS INJECTION: BEGIN -->
                                                        <tr style="background:darkgray;">
                                                            <td colspan="3"><strong>Total</strong></td>
                                                            <td colspan="2"><strong>CHF {{ totalDebit }}</strong></td>
                                                        </tr>
                                                        <!-- TOTALS INJECTION: END -->
                                                    </table>
                                                {% else %}
                                                    <aside class="pz-aside-info" ><strong>keine Debitoren</strong></aside>
                                                {% endif %}
                                            </div>
                                            {# DEBITORS PAYMENTS: END#}
                                            
                                            {# CASH EXPENSES: START #}
                                            <div class="pz-cash-expenses table-responsive">
                                                <h5 class="pz-sub-page-heading">Barausgaben<span data-tip="Datentabelle<br />Ein/Ausschalten" class="fa fa-eye-slash pull-right pz-cash-expenses-toggle"></span></h5>
                                                {% if cashExpenses is defined and cashExpenses %}
                                                    {%  set totalCashExpenses = 0 %}
                                                    {%  set totalCashExpenses = 0 %}
                                                    <table class="table table-bordered table-striped pz-expenses-tbl">
                                                        <tr>
                                                            <td class="barausgaben_konto"><strong class="fett">Konto</strong></td>
                                                            <td class="barausgaben_nummer"><strong class="fett">Nummer</strong></td>
                                                            <td class="barausgaben_objekt"><strong class="fett">Objekt</strong></td>
                                                            <td class="barausgaben_betrag" style="width:25%;"><strong class="fett">Betrag</strong></td>
                                                        </tr>
                                                        {% for cashExpense in cashExpenses %}
                                                            {%  set totalCashExpenses = totalCashExpenses + cashExpense.BH_Journal_betrag %}
                                                            <tr>
                                                                <td class="barausgaben_konto"><span class="pz-expense">{{ cashExpense.BH_Journal_konto_soll }}</span></td>
                                                                <td class="barausgaben_nummer"><span class="pz-expense">{{ cashExpense.BH_Journal_id }}</span></td>
                                                                <td class="barausgaben_objekt"><span class="pz-expense">{{ cashExpense.BH_Journal_kommentar }}</span></td>
                                                                <td class="barausgaben_betrag" style="width:25%;"><span class="pz-expense">{{ cashExpense.BH_Journal_betrag }}</span></td>
                                                            </tr>
                                                        {% endfor %}
                                                        <tr>
                                                            <td class="barausgaben_konto" colspan="3"><strong class="fett">Total</strong></td>
                                                            <td class="barausgaben_betrag" style="width:25%;"><strong class="fett">CHF {{ totalCashExpenses | number_format(2, ',', "'") }}</strong></td>
                                                        </tr>
                                                    </table>
                                                {% else %}
                                                    <aside class="pz-aside-info"><strong>Keine Barausgaben</strong></aside>
                                                {% endif %}
                                            </div>
                                            {# CASH EXPENSES: END #}
                                            
                                            
                                            {# SUMMARY: START #}
                                            <div class="pz-cash-expenses table-responsive">
                                                {# $gesamttotal = $total+$total_debit; #}
                                                {%  set globalTotal = totalDebit + grandTotal %}
                                                <h5 class="pz-sub-page-heading">Zusammenfassung<span data-tip="Datentabelle<br />Ein/Ausschalten" class="fa fa-eye-slash pull-right pz-summary-toggle"></span></h5>
                                                <table class="table table-bordered table-striped pz-summary-tbl">
                                                    <tr>
                                                        <td class="" ><strong class="" style="font-style: italic;">Ladenverkauf total</strong></td>
                                                        <td class="" style="width:25%;">CHF {{ grandTotal | number_format(2, ',', "'") }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="" ><strong class="" style="font-style: italic;">Debitoren</strong></td>
                                                        <td class="" style="width:25%;">CHF {{ totalDebit | number_format(2, ',', "'") }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td class="" ><strong class="" style="">Gesamttotal</strong></td>
                                                        <td class="" style="width:25%;"><strong class="">CHF {{ globalTotal | number_format(2, ',', "'") }}</strong></td>
                                                    </tr>
                                                </table>
                                            </div>
                                            {# SUMMARY: END #}
                                        
                                        </div>
                                        {#  70% GRID SETUP: STOP #}
                                        
                                        {#  30% GRID SETUP: START #}
                                        {% set personID = app.user.personId %}
                                        {% set slTotal = cashPayments[personID]['salesTotal'] is defined ? cashPayments[personID]['salesTotal'] : 0 %}
                                        <div class="pz-col-2--3-4-grid">
                                            <h5 class="pz-sub-page-heading">Kennzahlen</h5>
                                            <div class="table-responsive">
                                                <table class="Zusammenfassung table table-striped table-bordered">
                                                    <tr>
                                                        <td>Tagesumsatz: </td>
                                                        <td style="width:40%;"><strong>CHF {{ globalTotal | number_format(2, ',', "'") }}</strong></td>
                                                    </tr>
                                                </table>
                                            </div>
                                           
										   <h5 class="pz-sub-page-heading">Datenblatt</h5>
                                            <div class="table-responsive">
                                                <table class="Zusammenfassung table table-striped table-bordered pz-data-sheet"  id="pz-data-sheet">
                                                    <tr>
                                                        <td>Bareinnahmen: </td>
                                                        <td style="width:40%;"><strong>CHF {{ slTotal | number_format(2, ',', "'") }}</strong></td>
                                                    </tr>
                                                    
                                                    <tr>
                                                        <td>Kasse: </td>
                                                        <td style="width:40%;"><strong>CHF {{ cashBalance | number_format(2, ',', "'") }}</strong></td>
                                                    </tr>
                                                    
                                                    <tr>
                                                        <td>Kasse netto: </td>
                                                        {% set xBalance = cashBalance-900 %}
                                                        <td style="width:40%;"><strong>CHF {{ xBalance | number_format(2, ',', "'") }}</strong></td>
                                                    </tr>
                                                    
                                                    <tr>
                                                        <td>Kartenzahlungen: </td>
                                                        <td style="width:40%;">
                                                            {% if  cardsPaymentTotal is defined %}
                                                                <strong>CHF {{ cardsPaymentTotal | number_format(2, ',', "'") }}</strong>
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                    
                                                    <tr>
                                                        <td>Rechnungen: </td>
                                                        <td style="width:40%;">
                                                            {% if totalDebit is defined %}
                                                                <strong>CHF {{ totalDebit | number_format(2, ',', "'") }}</strong>
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                    
                                                    <tr>
                                                        <td>Barausgaben: </td>
                                                        
                                                        <td style="width:40%;"><strong>CHF {{ totalCashExpenses | number_format(2, ',', "'") }}</strong></td>
                                                    </tr>
                                                    
                                                    {% if(app.user.personId == '940') %}
                                                        {# MUSTERGASSE #}
                                                    {% elseif(app.user.personId == '941') %}
                                                        {# HIRSCHENGRABEN #}
                                                    {% endif %}
                                                </table>
                                            </div>
    
    
                                            <h5 class="pz-sub-page-heading">Kartenzahlungen</h5>
                                            <div class="pz-well" style="padding:15px;box-sizing:border-box;">
                                                Bitte alle Barbelege mit der Barausgaben-Abrechnung ganz unten auf der Seite vergleichen und wenn nötig Belege nachtragen. Danach Belege ins Fächli von Philippe legen.
                                            </div>
    
    
                                            <div id="barChartBlock" class="barChartBlock"></div>
                                            <script>
                                                Highcharts.chart('barChartBlock', {
                                                    chart: {
                                                        type: 'column'
                                                    },
                                                    title: {
                                                        text: 'Tagesabrechnung - Balkendiagramm' // 'Datenblatt - Balkendiagramm'
                                                    },
                                                    subtitle: {
                                                        text: 'Von: <a href="/admin">MJR Tool</a>'
                                                    },
                                                    xAxis: {
                                                        type: 'category',
                                                        labels: {
                                                            rotation: -45,
                                                            style: {
                                                                fontSize: '13px',
                                                                fontFamily: 'Verdana, sans-serif'
                                                            }
                                                        }
                                                    },
                                                    yAxis: {
                                                        min: 0,
                                                        title: {
                                                            text: 'Total (CHF):'
                                                        }
                                                    },
                                                    legend: {
                                                        enabled: false
                                                    },
                                                    tooltip: {
                                                        pointFormat: 'Total: <b>CHF {point.y:.1f} </b>'
                                                    },
                                                    series: [{
                                                        name: 'Total',
                                                        data: [
                                                            [ 'Bareinnahmen', {{ slTotal | float }} ],
                                                            [ 'Kasse', {{ cashBalance | float }} ],
                                                            [ 'Kasse netto', {{ xBalance | float }} ],
                                                            [ 'Kartenzahlungen', {{ cardsPaymentTotal | float }} ],
                                                            [ 'Rechnungen', {{ totalDebit | float }} ],
                                                            [ 'Barausgaben', {{ totalCashExpenses | float }} ]
                                                        ],
                                                        dataLabels: {
                                                            enabled: true,
                                                            rotation: -90,
                                                            color: '#000000',
                                                            align: 'right',
                                                            format: '{point.y:.1f}', // one decimal
                                                            y: 10, // 10 pixels down from the top
                                                            style: {
                                                                fontSize: '13px',
                                                                fontFamily: 'Verdana, sans-serif'
                                                            }
                                                        }
                                                    }]
                                                });
                                            </script>
                                            
                                        </div>
                                        {#  30% GRID SETUP: STOP #}
                                    </div>
                                    {#  70% BY 30% GRID SETUP: STOP #}
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </section>
        </section>
    </section>
{% endblock %}

{% block footer %}
    {% include '/admin/partials/footer.html.twig' %}
{% endblock %}

{% block footer_scripts %}
    <script type="text/javascript" src="{{ asset('js/jquery-3.1.0.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('js/jquery.easing.1.3.js') }}"></script>
    
    <script type="text/javascript" src="{{ asset('js/jquery.poiz_tooltip.js') }}"></script>
    <script type="text/javascript" src="{{ asset('js/pz_melli.js') }}"></script>
    
    <script>
    </script>
{% endblock %}
